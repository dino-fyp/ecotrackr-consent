<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EcoTrackr ‚Äì Trail Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ... (Keep your existing CSS here) ... */
    .btn.hidden { display: none; }
    .status-badge { font-size: 12px; padding: 4px 8px; border-radius: 20px; background: #dcfce7; color: #166534; font-weight: bold; }
  </style>
</head>
<body>

<div class="phone">
  <div class="header">
    <h2>EcoTrackr Consent</h2>
    <p id="trailStatus">Eco-Trail Safety & Navigation</p>
  </div>

  <div class="content" id="mainContent">
    <p>Outdoor activities involve inherent risks. You agree to follow all safety instructions provided by EcoTrackr checkpoints.</p>
    
    <div class="divider"></div>

    <div class="location" id="navigationBox">
      <strong id="locTitle">üìç Trail Starting Point</strong>
      <p id="locDesc">Tap ‚ÄúAccept & Continue‚Äù to navigate to Checkpoint 1.</p>
    </div>
  </div>

  <div class="buttons" id="consentButtons">
    <button class="btn accept" onclick="acceptConsent()">I Agree & Continue</button>
    <button class="btn decline" onclick="declineConsent()">I Do Not Agree</button>
  </div>

  <div class="buttons hidden" id="navButtons">
    <a id="dynamicMapsLink" href="https://www.google.com/maps/search/?api=1&query=3.0698,101.5037" 
       target="_blank" class="btn accept" style="text-decoration:none;">
       Open Maps to Checkpoint 1
    </a>
    <p style="text-align:center; font-size:12px; color:#64748b;">Scan your RFID at the node to unlock Checkpoint 2.</p>
  </div>

  <div class="footer-note">EcoTrackr ¬© 2025 ¬∑ Safety-First Eco Tourism</div>
</div>

<script>
  // Extract token from URL
  const urlParams = new URLSearchParams(window.location.search);
  const token = urlParams.get('token');

  function acceptConsent() {
    // Hide consent, show navigation to CP1
    document.getElementById('consentButtons').classList.add('hidden');
    document.getElementById('navButtons').classList.remove('hidden');
    
    // Start checking for CP1 scan
    startStatusPolling();
  }

  function startStatusPolling() {
    const poll = setInterval(() => {
      // Use your actual server domain here
      fetch(`https://your-server-ip/api/get_hiker_progress.php?token=${token}`)
        .then(res => res.json())
        .then(data => {
          if (data.status === 'at_checkpoint_1') {
            clearInterval(poll); // Stop asking the server
            unlockCheckpoint2();
          }
        })
        .catch(err => console.error("Sync Error:", err));
    }, 5000); // Check every 5 seconds
  }

  function unlockCheckpoint2() {
    // Update UI for the second leg of the journey
    document.getElementById('locTitle').innerHTML = "‚úÖ Checkpoint 1 Reached!";
    document.getElementById('locDesc').innerText = "You are on the trail. Navigate to the Exit point below.";
    document.getElementById('navigationBox').style.background = "#f0fdf4";
    
    const mapBtn = document.getElementById('dynamicMapsLink');
    mapBtn.innerText = "Navigate to Checkpoint 2 (Exit)";
    mapBtn.href = "https://www.google.com/maps/search/?api=1&query=3.0725,101.4812";
    mapBtn.style.background = "#16a34a";
  }

  function declineConsent() {
    alert("You must accept the consent to participate.");
  }
</script>

</body>
</html>
